---
import { getCollection } from "astro:content";
import PageLayout from "@layouts/PageLayout.astro";
import Container from "@components/Container.astro";

// 收集所有 blog 文章
const posts = (await getCollection("blog"))
  .filter(post => !post.data.draft);

// 統計所有標籤
const tagCounts = new Map<string, number>();
posts.forEach(post => {
  if (post.data.tags) {
    post.data.tags.forEach((tag: string) => {
      tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);
    });
  }
});

// 轉換為陣列並按標籤名稱排序
const tags = Array.from(tagCounts.entries())
  .sort(([a], [b]) => a.localeCompare(b));
---

<PageLayout title="Tags" description="All tags used in blog posts">
  <Container>
    <div class="space-y-10">
      <div class="animate font-semibold text-black dark:text-white">
        All Tags
      </div>
      
      {tags.length > 0 ? (
        <div class="space-y-6">
          <p class="animate text-sm opacity-75">
            Found {tags.length} tag{tags.length !== 1 ? 's' : ''} across {posts.length} post{posts.length !== 1 ? 's' : ''}
          </p>
          
          <div class="animate flex flex-wrap gap-3">
            {tags.map(([tag, count]) => (
              <a 
                href={`/blog/tags/${encodeURIComponent(tag.toLowerCase())}`}
                class="group flex items-center gap-2 px-4 py-2 bg-black/5 dark:bg-white/5 hover:bg-black/10 dark:hover:bg-white/10 rounded-lg border border-black/10 dark:border-white/20 transition-colors"
              >
                <span class="font-medium text-black dark:text-white">
                  #{tag}
                </span>
                <span class="text-xs px-2 py-1 bg-black/10 dark:bg-white/10 rounded-full opacity-60 group-hover:opacity-80 transition-opacity">
                  {count}
                </span>
              </a>
            ))}
          </div>
        </div>
      ) : (
        <p class="animate text-sm opacity-75">
          No tags found in blog posts.
        </p>
      )}
    </div>
  </Container>
</PageLayout>